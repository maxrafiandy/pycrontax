SELECT *, 11 masapajak, 2019 tahunpajak, NOW(), NOW()                                                                                                                                                       FROM (                                                                                                                                                                                            (                                                                                                                                                                                                 SELECT master.*,                                                                                                                                                                                3 status,                                                                                                                                                                                       COALESCE(sukses1.transactionamount, 0) autodebet_1,                                                                                                                                             COALESCE(sukses2.transactionamount, 0) autodebet_2,                                                                                                                                             COALESCE(sukses3.transactionamount, 0) autodebet_3                                                                                                                                              FROM                                                                                                                                                                                            (                                                                                                                                                                                                 SELECT nop                                                                                                                                                                                      FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) master                                                                                                                                                                                        -- sukses 3 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, status, sum(transactionamount) as transactionamount                                                                                                                                 FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS = 3                                                                                                                                                                                  AND masapajak = 09                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop, status                                                                                                                                                                          ) sukses1 on sukses1.nop = master.nop                                                                                                                                                           -- sukses 2 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, status, sum(transactionamount) as transactionamount                                                                                                                                 FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS = 3                                                                                                                                                                                  AND masapajak = 10                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses2 on sukses2.nop = master.nop                                                                                                                                                           -- sukses 1 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, status, sum(transactionamount) as transactionamount                                                                                                                                 FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS = 3                                                                                                                                                                                  AND masapajak = 11                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses3 on sukses3.nop = master.nop                                                                                                                                                         )                                                                                                                                                                                               UNION                                                                                                                                                                                           (                                                                                                                                                                                                 SELECT master.*,                                                                                                                                                                                4 status,                                                                                                                                                                                       COALESCE(sukses1.transactionamount, 0) autodebet_1,                                                                                                                                             COALESCE(sukses2.transactionamount, 0) autodebet_2,                                                                                                                                             COALESCE(sukses3.transactionamount, 0) autodebet_3                                                                                                                                              FROM                                                                                                                                                                                            (                                                                                                                                                                                                 SELECT nop                                                                                                                                                                                      FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) master                                                                                                                                                                                        -- sukses 3 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, 4 status, sum(transactionamount) as transactionamount                                                                                                                               FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS != 3                                                                                                                                                                                 AND masapajak = 09                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop, status                                                                                                                                                                          ) sukses1 on sukses1.nop = master.nop                                                                                                                                                           -- sukses 2 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, 4 status, sum(transactionamount) as transactionamount                                                                                                                               FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS != 3                                                                                                                                                                                 AND masapajak = 10                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses2 on sukses2.nop = master.nop                                                                                                                                                           -- sukses 1 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, 4 status, sum(transactionamount) as transactionamount                                                                                                                               FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS != 3                                                                                                                                                                                 AND masapajak = 11                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses3 on sukses3.nop = master.nop                                                                                                                                                         )                                                                                                                                                                                             ) mpd_sspd                                                                                                                                                                                      WHERE autodebet_1 != 0                                                                                                                                                                          AND autodebet_2 != 0                                                                                                                                                                            AND autodebet_3 != 0SELECT *, 11 masapajak, 2019 tahunpajak, NOW(), NOW()                                                                                                                                                       FROM (                                                                                                                                                                                            (                                                                                                                                                                                                 SELECT master.*,                                                                                                                                                                                3 status,                                                                                                                                                                                       COALESCE(sukses1.transactionamount, 0) autodebet_1,                                                                                                                                             COALESCE(sukses2.transactionamount, 0) autodebet_2,                                                                                                                                             COALESCE(sukses3.transactionamount, 0) autodebet_3                                                                                                                                              FROM                                                                                                                                                                                            (                                                                                                                                                                                                 SELECT nop                                                                                                                                                                                      FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) master                                                                                                                                                                                        -- sukses 3 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, status, sum(transactionamount) as transactionamount                                                                                                                                 FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS = 3                                                                                                                                                                                  AND masapajak = 09                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop, status                                                                                                                                                                          ) sukses1 on sukses1.nop = master.nop                                                                                                                                                           -- sukses 2 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, status, sum(transactionamount) as transactionamount                                                                                                                                 FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS = 3                                                                                                                                                                                  AND masapajak = 10                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses2 on sukses2.nop = master.nop                                                                                                                                                           -- sukses 1 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, status, sum(transactionamount) as transactionamount                                                                                                                                 FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS = 3                                                                                                                                                                                  AND masapajak = 11                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses3 on sukses3.nop = master.nop                                                                                                                                                         )                                                                                                                                                                                               UNION                                                                                                                                                                                           (                                                                                                                                                                                                 SELECT master.*,                                                                                                                                                                                4 status,                                                                                                                                                                                       COALESCE(sukses1.transactionamount, 0) autodebet_1,                                                                                                                                             COALESCE(sukses2.transactionamount, 0) autodebet_2,                                                                                                                                             COALESCE(sukses3.transactionamount, 0) autodebet_3                                                                                                                                              FROM                                                                                                                                                                                            (                                                                                                                                                                                                 SELECT nop                                                                                                                                                                                      FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) master                                                                                                                                                                                        -- sukses 3 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, 4 status, sum(transactionamount) as transactionamount                                                                                                                               FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS != 3                                                                                                                                                                                 AND masapajak = 09                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop, status                                                                                                                                                                          ) sukses1 on sukses1.nop = master.nop                                                                                                                                                           -- sukses 2 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, 4 status, sum(transactionamount) as transactionamount                                                                                                                               FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS != 3                                                                                                                                                                                 AND masapajak = 10                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses2 on sukses2.nop = master.nop                                                                                                                                                           -- sukses 1 bulan terakhir                                                                                                                                                                      left join (                                                                                                                                                                                       SELECT nop, 4 status, sum(transactionamount) as transactionamount                                                                                                                               FROM mpd_sspd                                                                                                                                                                                   WHERE nop is not null                                                                                                                                                                           AND STATUS != 3                                                                                                                                                                                 AND masapajak = 11                                                                                                                                                                              AND tahunpajak = 2019                                                                                                                                                                           GROUP BY nop                                                                                                                                                                                  ) sukses3 on sukses3.nop = master.nop                                                                                                                                                         )                                                                                                                                                                                             ) mpd_sspd                                                                                                                                                                                      WHERE autodebet_1 != 0                                                                                                                                                                          AND autodebet_2 != 0                                                                                                                                                                            AND autodebet_3 != 0SELECT *, 11 masapajak, 2019 tahunpajak, NOW(), NOW()
            FROM (
              (
                SELECT master.*,
                3 status,
                COALESCE(sukses1.transactionamount, 0) autodebet_1,
                COALESCE(sukses2.transactionamount, 0) autodebet_2,
                COALESCE(sukses3.transactionamount, 0) autodebet_3
                FROM
                (
                  SELECT nop
                  FROM mpd_sspd
                  WHERE nop is not null
                  GROUP BY nop
                ) master
                -- sukses 3 bulan terakhir
                left join (
                  SELECT nop, status, sum(transactionamount) as transactionamount
                  FROM mpd_sspd
                  WHERE nop is not null
                  AND STATUS = 3
                  AND masapajak = 09
                  AND tahunpajak = 2019
                  GROUP BY nop, status
                ) sukses1 on sukses1.nop = master.nop
                -- sukses 2 bulan terakhir
                left join (
                  SELECT nop, status, sum(transactionamount) as transactionamount
                  FROM mpd_sspd
                  WHERE nop is not null
                  AND STATUS = 3
                  AND masapajak = 10
                  AND tahunpajak = 2019
                  GROUP BY nop
                ) sukses2 on sukses2.nop = master.nop
                -- sukses 1 bulan terakhir
                left join (
                  SELECT nop, status, sum(transactionamount) as transactionamount
                  FROM mpd_sspd
                  WHERE nop is not null
                  AND STATUS = 3
                  AND masapajak = 11
                  AND tahunpajak = 2019
                  GROUP BY nop
                ) sukses3 on sukses3.nop = master.nop
              )
              UNION
              (
                SELECT master.*,
                4 status,
                COALESCE(sukses1.transactionamount, 0) autodebet_1,
                COALESCE(sukses2.transactionamount, 0) autodebet_2,
                COALESCE(sukses3.transactionamount, 0) autodebet_3
                FROM
                (
                  SELECT nop
                  FROM mpd_sspd
                  WHERE nop is not null
                  GROUP BY nop
                ) master
                -- sukses 3 bulan terakhir
                left join (
                  SELECT nop, 4 status, sum(transactionamount) as transactionamount
                  FROM mpd_sspd
                  WHERE nop is not null
                  AND STATUS != 3
                  AND masapajak = 09
                  AND tahunpajak = 2019
                  GROUP BY nop, status
                ) sukses1 on sukses1.nop = master.nop
                -- sukses 2 bulan terakhir
                left join (
                  SELECT nop, 4 status, sum(transactionamount) as transactionamount
                  FROM mpd_sspd
                  WHERE nop is not null
                  AND STATUS != 3
                  AND masapajak = 10
                  AND tahunpajak = 2019
                  GROUP BY nop
                ) sukses2 on sukses2.nop = master.nop
                -- sukses 1 bulan terakhir
                left join (
                  SELECT nop, 4 status, sum(transactionamount) as transactionamount
                  FROM mpd_sspd
                  WHERE nop is not null
                  AND STATUS != 3
                  AND masapajak = 11
                  AND tahunpajak = 2019
                  GROUP BY nop
                ) sukses3 on sukses3.nop = master.nop
              )
            ) mpd_sspd
            WHERE autodebet_1 != 0
            AND autodebet_2 != 0
            AND autodebet_3 != 0